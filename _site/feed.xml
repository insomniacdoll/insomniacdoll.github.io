<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
<title type="text">零時寝子</title>
<generator uri="https://github.com/mojombo/jekyll">Jekyll</generator>
<link rel="self" type="application/atom+xml" href="/feed.xml" />
<link rel="alternate" type="text/html" href="" />
<updated>2015-03-26T15:50:59+00:00</updated>
<id>/</id>
<author>
  <name>Insomnia</name>
  <uri>/</uri>
  <email>insomniacdoll@gmail.com</email>
</author>


<entry>
  <title type="html"><![CDATA[在My Cloud EX2上安装aria2和yaaw]]></title>
 <link rel="alternate" type="text/html" href="/install-aria2-on-my-cloud-ex2/" />
  <id>/install-aria2-on-my-cloud-ex2</id>
  <published>2015-03-20T00:00:00+00:00</published>
  <updated>2015-03-20T00:00:00+00:00</updated>
  <author>
    <name>Insomnia</name>
    <uri></uri>
    <email>insomniacdoll@gmail.com</email>
  </author>
  <content type="html">
    &lt;h3 id=&quot;section&quot;&gt;0. 前言&lt;/h3&gt;

&lt;p&gt;之前一直在使用My Book Live，可以方便地使用自带的Debian系统进行应用扩展。配合最常用的aria2和yaaw，可以方便地进行百度网盘、115网盘、迅雷离线等网络存储的脱机下载。&lt;/p&gt;

&lt;p&gt;但由于My Book Live在设计上是单盘不可更换硬盘的结构，所以存储满了之后想更换一台扩展性更好的NAS，使用习惯的原因促使我购买了My Book Live的后续产品My Cloud EX2。但没想到My Cloud EX2更换了内部的软件系统，底层的Linux操作系统不再基于Debian，而是一个没有包管理器的自行定制内核，shell使用了busybox进行代替。想要直接安装软件就困难了许多。&lt;/p&gt;

&lt;h3 id=&quot;section-1&quot;&gt;1. 前期准备&lt;/h3&gt;

&lt;p&gt;首先是需要将原来My Book Live的数据备份出来，最快的办法是使用暴力将其拆开，然后将硬盘挂载到主板的SATA接口上进行数据对拷。这样多出来的数据盘还可以继续利用。&lt;/p&gt;

&lt;p&gt;拆机的攻略可以参照：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;http://bbs.feng.com/read-htm-tid-5609125.html&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;另外，拆机完成，挂载硬盘到SATA接口上以后，Linux操作系统（比如Ubuntu）是不能直接识别大分区的，需要进行如下操作：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;sudo apt-get install fuseext2 parted
sudo parted -l &lt;span class=&quot;c&quot;&gt;#找到磁盘标识，如/dev/sdb&lt;/span&gt;
sudo fuseext2 -o allow_other -o ro -o sync_read /dev/sdb4 /mnt/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;其中allow_other参数很重要，否则会报没有权限的错误。&lt;/p&gt;

&lt;p&gt;然后尽情备份即可。&lt;/p&gt;

&lt;h3 id=&quot;section-2&quot;&gt;2. 制作交叉编译工具链&lt;/h3&gt;

&lt;p&gt;由于没有包管理器，不可能直接直接安装软件，那么就只能自行使用交叉编译工具进行源码编译。&lt;/p&gt;

&lt;p&gt;首先看一下系统的芯片类型：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;c&quot;&gt;# cat /proc/cpuinfo&lt;/span&gt;
Processor       : Marvell PJ4Bv7 Processor rev &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;v7l&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
BogoMIPS        : 1196.85
Features        : swp half thumb fastmult vfp edsp vfpv3 vfpv3d16 tls 
CPU implementer : 0x56
CPU architecture: 7
CPU variant     : 0x1
CPU part        : 0x581
CPU revision    : 1

Hardware        : Marvell Armada-370
Revision        : 0000
Serial          : 0000000000000000&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;芯片类型是Marvell Armada-370，也是定制的ARM芯片，那么可以使用crosstool-ng来进行交叉编译器构建。&lt;/p&gt;

&lt;p&gt;首先在宿主机（Ubuntu 14.04 LTS）上面从源码编译安装crosstool-ng，下载地址：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;http://crosstool-ng.org/download/crosstool-ng/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;在编译安装crosstool-ng交叉工具之前，要安装与crosstool-ng工具相依赖的包文件：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;c&quot;&gt;# apt-get install gcc g++ gdb libncurses5-dev bison flex texinfo autoconf automake libtool patch gcj cvs cvsd gawk pkg-config&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;安装好以上依赖的包文件后，就可以编译安装crosstool-ng交叉编译工具了，在编译crosstool-ng交叉编译工具之前，要先配置crosstool-ng交叉编译工具的安装路径：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;./configure --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;配置好安装路径后就要编译安装了：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;make
make install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;安装好crosstool-ng交叉编译工具后，就要用该工具构建自己的交叉编译链，构建自己的交叉编译工具链之前，要建立自己的工作目录，还有对应的源码文件，然后拷贝默认配置文件到工作目录，进入工作目录后：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;cp ../crosstool-ng-1.9.3/samples/arm-unknown-linux-gnueabi /* ./   （以1.9.3为例）&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;修改文件名：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;mv crosstool.config .config&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;进入menuconfig，开始修改配置：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;../crosstool-ng-1.9.3_install/bin/ct-ng menuconfig&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;编译选项需要注意的选项如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;Paths and misc options  ---&amp;gt;Local tarballs directory  
  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;/work/tools/Armada-370/crosstool-ng/src&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Local tarballs directory   保存源码包路径
Paths and misc options  ---&amp;gt;Prefix directory   
  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;/work/tools/Armada-370/x-tools/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CT_TARGET&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Prefix directory  交叉编译器的安装路径
Target options ---&amp;gt;Architecture level  
Target options ---&amp;gt;Emit assembly &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; CPU&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上面两个根据实际目标板来填写。每一项都可以进去看看，写的都很明确。&lt;/p&gt;

&lt;p&gt;这里还有个问题，就是源码包的版本在配置选项中没有的情况，可以通过打开工作目录下的vim .config文件手动修改。&lt;/p&gt;

&lt;p&gt;配置好路径和工具的各个版本后，直接运行：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;../crosstool_install/bin/ct-ng build&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;进行build前面的配置。最后就是漫长的等待（中间需要下载源码），等待之后，自己的交叉编译工具链就完成了。&lt;/p&gt;

&lt;p&gt;此外，其实群晖的某个NAS也使用了Armada-370这个芯片进行产品定制，且放出了开发工具包，可以直接下载来使用：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;http://sourceforge.net/projects/dsgpl/files/DSM%204.3%20Tool%20Chains/Marvell%20armada%20370%20Linux%203.2.40/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;但是&lt;strong&gt;需要注意&lt;/strong&gt;，这个现成的工具包gcc编译器版本是4.6，并不支持包含c++11特性的代码编译。后续文章讲到使用NAS来构建PS3镜像流文件服务器的时候，就必须要使用自行构建的工具链。&lt;/p&gt;

&lt;h3 id=&quot;aria2c&quot;&gt;3. 编译aria2c&lt;/h3&gt;

&lt;p&gt;现在交叉编译器到手，就可以来直接编译aria2c了，能够进行脱机下载功能的aria2c使用到的第三方包包括c-ares、expat和zlib。&lt;/p&gt;

&lt;p&gt;为了自动下载源码和编译，我编写了一个shell脚本来完成：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;CWD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;NJOB&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4

&lt;span class=&quot;c&quot;&gt;# Local folder where we install built binaries and libraries.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;LOCAL_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;readlink -f ./local&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
mkdir -p &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Cross-compiler tools&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;TOOL_BIN_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/opt/arm-marvell-linux-gnueabi/bin
&lt;span class=&quot;nv&quot;&gt;TOOL_CC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOL_BIN_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/arm-marvell-linux-gnueabi-gcc
&lt;span class=&quot;nv&quot;&gt;TOOL_CXX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOL_BIN_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/arm-marvell-linux-gnueabi-g++

&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOL_BIN_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# zlib&lt;/span&gt;
rm -rf  zlib*
wget http://zlib.net/zlib-1.2.8.tar.gz ./
tar xzf zlib*.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;zlib*/
&lt;span class=&quot;nv&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TOOL_CC&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;-O4&amp;quot;&lt;/span&gt; ./configure --static
make -j&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;NJOB&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
make install

&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CWD&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# expat&lt;/span&gt;
rm -rf expat*
wget http://downloads.sourceforge.net/expat/2.1.0/expat-2.1.0.tar.gz ./
tar xzf expat*.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;expat*/
./configure &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --host&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-marvell-linux-gnueabi &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --build&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;i686-linux-gnu &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --enable-shared&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --enable-static&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;yes &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
make -j&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;NJOB&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
make install

&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CWD&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# c-ares&lt;/span&gt;
rm -rf c-ares*
wget http://c-ares.haxx.se/download/c-ares-1.10.0.tar.gz ./
tar xzf c-ares*.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;c-ares*/
./configure &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --host&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-marvell-linux-gnueabi &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --build&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;i686-linux-gnu &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --enable-shared&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --enable-static&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;yes &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
make -j&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;NJOB&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
make install

&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CWD&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# aria2&lt;/span&gt;
rm -rf aria2*
wget http://downloads.sourceforge.net/aria2/aria2-1.18.10.tar.xz ./
tar xJf aria2*.tar.xz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;aria2*/
./configure &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --host&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-marvell-linux-gnueabi &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --build&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;i686-linux-gnu &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --disable-nls &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --disable-ssl &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --disable-epoll &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --without-gnutls &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --without-openssl &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --without-sqlite3 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --without-libxml2 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --with-libexpat --with-libexpat-prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --with-libcares --with-libcares-prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --with-libz --with-libz-prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LOCAL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --enable-static&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;yes &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;CXXFLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;-Os -g&amp;quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;-Os -g&amp;quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;LDFLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;-L${LOCAL_DIR}/lib&amp;quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;PKG_CONFIG_LIBDIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;${LOCAL_DIR}/lib/pkgconfig&amp;quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;ARIA2_STATIC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;yes&amp;quot;&lt;/span&gt;
make -j&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;NJOB&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
make install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上面的shell脚本可以直接自动从网络上下载截止博文发出的最新版本的aria2及其依赖的源码，并进行编译（全部使用静态编译，避免运行环境找不到库的情况出现）。&lt;/p&gt;

&lt;p&gt;需要注意的是，TOOL_BIN_DIR是交叉工具链的安装目录，需要按照实际情况进行修改。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;另外这个脚本应该在一个干净的目录进行执行。&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;aria2cyaaw&quot;&gt;4. 安装aria2c和yaaw&lt;/h3&gt;

&lt;p&gt;将编译得到的aria2上传到My Cloud EX2的目录：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;/mnt/HD/HD_a2/Nas_Prog&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;并建立一个配置文件，内容如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;daemon&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;#以daemon方式启动&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/mnt/HD/HD_a2/Private/Download  &lt;span class=&quot;c&quot;&gt;#下载目录&lt;/span&gt;
disable-ipv6&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#禁用IPv6&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt;-rpc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#启用RPC，对于yaaw的配合使用非常重要&lt;/span&gt;
rpc-allow-origin-all&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true &lt;/span&gt;
rpc-listen-all&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
rpc-listen-port&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;6800&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#监听端口&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#开启断点续传&lt;/span&gt;
input-file&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/mnt/HD/HD_a2/Nas_Prog/aria2/session/aria2.session &lt;span class=&quot;c&quot;&gt;#session保存地址，用于记录任务信息&lt;/span&gt;
save-session&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/mnt/HD/HD_a2/Nas_Prog/aria2/session/aria2.session
file-allocation&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;falloc &lt;span class=&quot;c&quot;&gt;#文件分配方式&lt;/span&gt;
max-concurrent-downloads&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#最大并行下载任务数量&lt;/span&gt;
max-connection-per-server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#每个服务器的并发连接数&lt;/span&gt;
min-split-size&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10M &lt;span class=&quot;c&quot;&gt;#最大文件分割大小&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#文件分割块数&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/mnt/HD/HD_a2/Nas_Prog/aria2/log/aria2.log &lt;span class=&quot;c&quot;&gt;#日志路径&lt;/span&gt;
log-level&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;warn &lt;span class=&quot;c&quot;&gt;#日志级别&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;然后用命令启动：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /mnt/HD/HD_a2/Nas_Prog/aria2
./aria2c --conf-path&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;./conf/aria2.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;然后安装yaaw，下载地址：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;https://github.com/binux/yaaw&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;解压后也放到/mnt/HD/HD_a2/Nas_Prog目录，然后建立一个指向web服务器根目录的软连接：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;ln -s /mnt/HD/HD_a2/Nas_Prog/yaaw /var/www/yaaw&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;这样就可以直接从NAS的IP访问到yaaw了。&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;5. 后续配置&lt;/h3&gt;

&lt;p&gt;使用上，可以配合百度云盘、115网盘的chrome插件进行。&lt;/p&gt;

&lt;p&gt;Chrome Web Store的地址：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;115网盘： https://chrome.google.com/webstore/detail/115exporter/ojafklbojgenkohhdgdjeaepnbjffdjf

百度网盘： https://chrome.google.com/webstore/detail/baiduexporter/mjaenbjdjmgolhoafkohbhhbaiedbkno&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;配置上，将json-rpc的地址指向【NAS的IP:6800】即可（默认情况），然后下载的时候选中需要下载的文件，按“导出到RPC”。&lt;/p&gt;

&lt;p&gt;此外，【http://NAS的IP/yaaw】这个地址可以查看aria2的运行情况，同时也可以使用Web的方式来使用Aria2，当然下载都是My Cloud EX2的任务了。&lt;/p&gt;

&lt;p&gt;-EOF-&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/install-aria2-on-my-cloud-ex2/&quot;&gt;在My Cloud EX2上安装aria2和yaaw&lt;/a&gt; was originally published by Insomnia at &lt;a href=&quot;&quot;&gt;零時寝子&lt;/a&gt; on March 20, 2015.&lt;/p&gt;
  </content>
</entry>


<entry>
  <title type="html"><![CDATA[cubietruck安装Cubieez/Lubuntu笔记]]></title>
 <link rel="alternate" type="text/html" href="/install-cubieez-lubuntu-on-cubietruck/" />
  <id>/install-cubieez-lubuntu-on-cubietruck</id>
  <published>2015-01-01T00:00:00+00:00</published>
  <updated>2015-01-01T00:00:00+00:00</updated>
  <author>
    <name>Insomnia</name>
    <uri></uri>
    <email>insomniacdoll@gmail.com</email>
  </author>
  <content type="html">
    &lt;p&gt;工具：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;PhoneixSuite&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Windows&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
SecureCRT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;固件下载链接：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;http://dl.cubieboard.org/software/a20-cubietruck/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;按照需求下载对应的固件，解压后使用PhoneixSuite刷入cubietruck即可。&lt;/p&gt;

&lt;p&gt;罗技无线键鼠没法使用的解决办法：&lt;/p&gt;

&lt;p&gt;因为内核中的驱动支持HIDRAW默认是关闭的，重新编译一次内核即可。&lt;/p&gt;

&lt;p&gt;烧录好的系统，ssh登录进去，到/proc/目录下找到config.gz，是当前内核的配置文件，拷贝出来到内核源码目录，解压重命名为.config。这么做是为了最大兼容当前运行内核。&lt;/p&gt;

&lt;p&gt;内核源码的github地址：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;https://github.com/linux-sunxi/linux-sunxi&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;或者可以去固件目录下载。&lt;/p&gt;

&lt;p&gt;当前交叉编译系统的版本必须是ubuntu 12.04 lts，保证编译器版本为gcc 4.6，高版本编译的内核无法在开发板上运行。&lt;/p&gt;

&lt;p&gt;交叉编译环境准备：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;sudo apt-get install build-essential u-boot-tools uboot-mkimage
sudo apt-get install gcc-arm-linux-gnueabihf gcc-arm-linux-gnueabi
sudo apt-get install libusb-1.0-0 libusb-1.0-0-dev git wget fakeroot kernel-package zlib1g-dev
sudo apt-get install libncurses5-dev&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;其他包按照提示安装即可。&lt;/p&gt;

&lt;p&gt;编译选项打开HIDRAW：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;make &lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm menuconfig&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;编译：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;make -j4 &lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm &lt;span class=&quot;nv&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-none-linux-gnueabi- uImage modules&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;安装modules：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;make &lt;span class=&quot;nv&quot;&gt;STRIP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-none-linux-gnueabi-strip &lt;span class=&quot;nv&quot;&gt;INSTALL_MOD_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;output &lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm &lt;span class=&quot;nv&quot;&gt;INSTALL_MOD_STRIP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; modules_install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;然后把output目录下的modules替换到开发板的/lib/modules下，/arch/arm/boot/uImage替换到开发板/boot目录下，内核就升级完成了，重启即可。&lt;/p&gt;

&lt;p&gt;-EOF-&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/install-cubieez-lubuntu-on-cubietruck/&quot;&gt;cubietruck安装Cubieez/Lubuntu笔记&lt;/a&gt; was originally published by Insomnia at &lt;a href=&quot;&quot;&gt;零時寝子&lt;/a&gt; on January 01, 2015.&lt;/p&gt;
  </content>
</entry>


<entry>
  <title type="html"><![CDATA[Felix入门与实践]]></title>
 <link rel="alternate" type="text/html" href="/felix-tutorial/" />
  <id>/felix-tutorial</id>
  <published>2013-01-30T00:00:00+00:00</published>
  <updated>2013-01-30T00:00:00+00:00</updated>
  <author>
    <name>Insomnia</name>
    <uri></uri>
    <email>insomniacdoll@gmail.com</email>
  </author>
  <content type="html">
    &lt;p&gt;首先，我假设你已经了解OSGi相关的一些概念，如果没有，可以看看官方的文档。&lt;/p&gt;

&lt;p&gt;我们从创建一个监听OSGi Service事件的bundle开始。这个小例子并不会包含太多的东西，只是打印出注册以及未注册的Service的详细信息而已。下一篇我才会开始介绍实现了Service的bundle，这次只是通过一个范例来加深对于创建bundle基础知识的理解。&lt;/p&gt;

&lt;p&gt;OSGi框架通过与bundle唯一对应的BundleContext来访问一个bundle，而得到BundleContext必须实现BundleActivator接口。这个接口有两个方法，start()和stop()。当bundle的被start或者stop的时候，BundleContext将作为参数传入这两个方法，然后这两个方法才会被调用。下面的源代码是一个bundle，当然它实现了BundleContext接口，同时这个bundle添加了自身作为Service事件的监听器。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kn&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tutorial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;example1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.osgi.framework.BundleActivator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.osgi.framework.BundleContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.osgi.framework.ServiceListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.osgi.framework.ServiceEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * This class implements a simple bundle that utilizes the OSGi&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * framework&amp;#39;s event mechanism to listen for service events. Upon&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt; * receiving a service event, it prints out the event&amp;#39;s details.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;**/&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Activator&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BundleActivator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ServiceListener&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * Implements BundleActivator.start(). Prints&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * a message and adds itself to the bundle context as a service&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * listener.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * @param context the framework context for the bundle.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;    **/&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BundleContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Starting to listen for service events.&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;addServiceListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * Implements BundleActivator.stop(). Prints&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * a message and removes itself from the bundle context as a&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * service listener.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * @param context the framework context for the bundle.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;    **/&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BundleContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;removeServiceListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Stopped listening for service events.&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// Note: It is not required that we remove the listener here,&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// since the framework will do it automatically anyway.&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * Implements ServiceListener.serviceChanged().&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * Prints the details of any service event from the framework.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;     * @param event the fired service event.&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;    **/&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;serviceChanged&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ServiceEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectClass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[])&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getServiceReference&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getProperty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;objectClass&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ServiceEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;REGISTERED&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;s&quot;&gt;&amp;quot;Ex1: Service of type &amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; registered.&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ServiceEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;UNREGISTERING&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;s&quot;&gt;&amp;quot;Ex1: Service of type &amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; unregistered.&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ServiceEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;MODIFIED&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;s&quot;&gt;&amp;quot;Ex1: Service of type &amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objectClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; modified.&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;完成bundle的Java代码之后还不够，我们还需要定义一个包含了meta-data信息的manifest文件，这样OSGi框架才能“操作”这个bundle。manifest文件要和编译好的Java Class打包成一个Jar，而这个Jar包实际上就是一个bundle。我们接下来创建一个名为manifest.mf的文件，内容如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;Bundle-Name: Service listener example
Bundle-Description: A bundle that displays messages at startup and when service events occur
Bundle-Vendor: Apache Felix
Bundle-Version: 1.0.0
Bundle-Activator: tutorial.example1.Activator
Import-Package: org.osgi.framework&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上面的meta-data信息大部分只是为了维护方便，实际上只有Bundle-Activator属性以及Import-Package属性是OSGi框架必须的。Bundle-Activator属性为框架指明了实现了BundleActivator接口的类。当OSGi框架start某个bundle的时候，将创建一个该属性指定的类的实例，同时调用该实例的start()方法；同样框架stop该bundle的时候，实例的stop()方法将被调用。Import-Package属性指定了这个bundle所依赖的外部类。所有的bundle必须导入org.osgi.framework这个类，因为它包含了OSGi类的核心定义。所有的包依赖关系都会由OSGi框架来验证以及处理。（注意，manifest文件最后一行之后必须有一个回车符，否则最后一行的内容将会被框架忽略。）&lt;/p&gt;

&lt;p&gt;然后就可以开始编译源代码了，我们需要把felix.jar添加到classpath中（Felix的bin目录中可以找到这个jar包），然后在命令行中运行：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;javac -d c:&lt;span class=&quot;se&quot;&gt;\c&lt;/span&gt;lasses *.java&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上面的命令将会编译classes目录下所有的源代码，并将class二进制字节码输出到指定的子文件夹tutorial\example1中。编译完成之后，就可以把class文件和之前写好的bundle的manifest文件打包成jar。接着在命令行中运行：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;jar cfm example1.jar manifest.mf -C c:&lt;span class=&quot;se&quot;&gt;\c&lt;/span&gt;lasses tutorial&lt;span class=&quot;se&quot;&gt;\e&lt;/span&gt;xample1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;一个打包好的bundle就到手了，用Felix的Shell就可以安装并运行这个bundle，比如：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;start file:/c:/tutorial/example1.jar&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上面的命令会自动安装并start这个bundle。当然我们也可以手动安装并且运行。Felix的Shell有install和start两个命令，分别运行一下就OK。另外stop命令可以stop指定的bundle，而shutdown则是关闭整个Felix环境。&lt;/p&gt;

&lt;p&gt;-EOF-&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/felix-tutorial/&quot;&gt;Felix入门与实践&lt;/a&gt; was originally published by Insomnia at &lt;a href=&quot;&quot;&gt;零時寝子&lt;/a&gt; on January 30, 2013.&lt;/p&gt;
  </content>
</entry>


<entry>
  <title type="html"><![CDATA[Windows下编译OpenJDK7 笔记]]></title>
 <link rel="alternate" type="text/html" href="/compile-jdk7-under-windows/" />
  <id>/compile-jdk7-under-windows</id>
  <published>2012-11-19T00:00:00+00:00</published>
  <updated>2012-11-19T00:00:00+00:00</updated>
  <author>
    <name>Insomnia</name>
    <uri></uri>
    <email>insomniacdoll@gmail.com</email>
  </author>
  <content type="html">
    &lt;h3 id=&quot;section&quot;&gt;0. 系统需求&lt;/h3&gt;

&lt;p&gt;Windows XP SP3 / Windows 7 （强烈推荐用英文版系统进行构建，原因后详）&lt;/p&gt;

&lt;h3 id=&quot;section-1&quot;&gt;1. 所需软件&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;Cygwin

Sun JDK 1.6 u14以上

Microsoft DirecxX SDK

Microsoft Visual Studio C++ &lt;span class=&quot;m&quot;&gt;2010&lt;/span&gt; （正式版或者Express版均可）

Apache Ant 1.7.1以上

Freetype-2.3.5-1

openjdk-7-fcs-src-b147-27_jun_2011.zip

Vim（可选，推荐编辑器）&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;section-2&quot;&gt;2.构建步骤&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;以下涉及安装软件的步骤，都建议将软件安装到没有空格非中文的路径，且安装的目录名精简一些。&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;(1) 首先安装Cygwin，所需的包如下所示：&lt;/p&gt;

&lt;table rules=&quot;groups&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;文件名&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;分类&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;包&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;描述&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ar.exe&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Devel&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;binutils&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;The GNU assembler, linker and binary utilities&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;make.exe&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Devel&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;make&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;The GNU version of the ‘make’ utility built for CYGWIN&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;m4.exe&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Interpreters&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;m4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;GNU implementation of the traditional Unix macro processor&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;cpio.exe&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Utils&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;cpio&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;A program to manage archives of files&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;gawk.exe&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Base&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;awk&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;Pattern-directed scanning and processing language&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;file.exe&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Utils&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;file&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;Determines file type using ‘magic’ numbers&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;zip.exe&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Archive&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;zip&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;Package and compress (archive) files&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;unzip.exe&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Archive&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;unzip&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;Extract compressed files in a ZIP archive&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;free.exe&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;System&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;procps&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;Display amount of free and used memory in the system&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;需要注意的是，安装的make.exe为3.82版，导致编译不能成功，需要从cygwin网站上下载3.81版本并覆盖到bin目录。也可以下载源码之后自己编译一个（需要gcc包）。最后将cygwin的bin目录添加到PATH环境变量。&lt;/p&gt;

&lt;p&gt;(2) 安装JDK6，版本需要u14以上（官方文档中称作Bootrap JDK），我采用的是u31版本。建立ALT_BOOTDIR和ALT_JDK_IMPORT_PATH环境变量，指向JDK的目录。注意不要设置JAVA_HOME和CLASSPATH环境变量。&lt;/p&gt;

&lt;p&gt;(3) 安装Apache Ant，版本1.7.1以上，我采用的是1.8.2。建立ANT_HOME环境变量。&lt;/p&gt;

&lt;p&gt;(4) 安装Freetype-2.3.5-1，建立ALT_FREETYPE_LIB_PATH 和ALT_FREETYPE_HEADERS_PATH环境变量，分别指向lib目录和include目录。将bin目录下的freetype6.dll和zlib1.dll复制到lib目录下。&lt;/p&gt;

&lt;p&gt;(5) 安装DirectX SDK。强烈建议此步在安装Visual Stuido 2010 (Express)之前进行，否则有可能DirectX SDK无法正常安装成功。建立ALT_DXSDK_PATH环境变量，指向安装目录。&lt;/p&gt;

&lt;p&gt;(6) 安装Microsoft Visual Studio C++ 2010 ，我采用的是Express版本（免费）。安装过程中会自动安装Windows SDK，且不能指定路径，在C:\Program Files\下。建立ALT_COMPILER_PATH 环境变量，指向VC++的bin目录。同时用以下命令将Windows SDK的目录转换为short路径（需要安装cygwin）：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;Cygpath –s –m “C:&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;rogram Files&lt;span class=&quot;se&quot;&gt;\M&lt;/span&gt;icrosoft SDKs&lt;span class=&quot;se&quot;&gt;\W&lt;/span&gt;indows&lt;span class=&quot;se&quot;&gt;\v&lt;/span&gt;7.0A”&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;之后建立WINDOWSSDKDIR 环境变量，指向该short路径。&lt;/p&gt;

&lt;p&gt;将WINDOWSSDKDIR 下的lib目录和VC++下的lib目录添加到LIB环境变量。&lt;/p&gt;

&lt;p&gt;将WINDOWSSDKDIR 下的include目录和VC++下的include目录添加到INCLUDE环境变量。&lt;/p&gt;

&lt;p&gt;去下载一个msvcr100.dll，并建立ALT_MSVCRNN_DLL_PATH 环境变量指向该文件所在的目录。如果你安装了Visual Studio C++ 2010，那么在你的系统中应该能找到这个文件，但是我用系统中自带的这个文件编译出的JDK不能正常运行，用下载的替换之后才可以。&lt;/p&gt;

&lt;p&gt;(7) 解压openjdk-7-fcs-src-b147-27_jun_2011.zip，下载jaxp-1_4_5-unittests.zip、jaxp145_01.zip、jdk7-jaf-2010_08_19.zip、jdk7-jaxws2_2_4-b03-2011_05_27.zip四个文件放在openjdk\java\devtools\share\jdk7-drops目录下。并建立ALT_DROPS_DIR 环境变量指向该目录。&lt;/p&gt;

&lt;p&gt;(8) 完善并检查环境变量，我写了一个批处理来进行环境变量设置：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;SET &lt;span class=&quot;nv&quot;&gt;VSINSTALLDIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;C:/PROGRA~2/MICROS~1.0
SET &lt;span class=&quot;nv&quot;&gt;WINDOWSSDKDIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;D:/jdkBuild/sdk
SET &lt;span class=&quot;nv&quot;&gt;ALT_BOOTDIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;D:/jdkBuild/JDK16~1.0_X
SET &lt;span class=&quot;nv&quot;&gt;ALT_JDK_IMPORT_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;D:/jdkBuild/JDK16~1.0_X
SET &lt;span class=&quot;nv&quot;&gt;ANT_HOME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;D:/jdkBuild/APACHE~1.4
SET &lt;span class=&quot;nv&quot;&gt;ALT_MSVCRNN_DLL_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;D:/jdkBuild/msvcr100
SET &lt;span class=&quot;nv&quot;&gt;ALT_DXSDK_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;D:/jdkBuild/msdxsdk
SET &lt;span class=&quot;nv&quot;&gt;ALT_FREETYPE_HEADERS_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;D:/jdkBuild/freetype/include
SET &lt;span class=&quot;nv&quot;&gt;ALT_FREETYPE_LIB_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;D:/jdkBuild/freetype/lib
SET &lt;span class=&quot;nv&quot;&gt;ALT_COMPILER_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%VSINSTALLDIR%/VC/bin/
SET &lt;span class=&quot;nv&quot;&gt;ALT_DROPS_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; D:/jdkBuild/openjdk/java/devtools/share/jdk7-drops
SET &lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%WINDOWSSDKDIR%/Bin/NETFX4~1.0TO&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;%WINDOWSSDKDIR%/Bin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;%VSINSTALLDIR%/VC/bin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;%VSINSTALLDIR%/Common7/IDE&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;E:/cygwin/bin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;%PATH%
SET &lt;span class=&quot;nv&quot;&gt;INCLUDE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%VSINSTALLDIR%/VC/INCLUDE&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;D:/jdkBuild/sdk/INCLUDE
SET &lt;span class=&quot;nv&quot;&gt;LIB&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%VSINSTALLDIR%/VC/Lib&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;D:/jdkBuild/sdk/Lib
SET &lt;span class=&quot;nv&quot;&gt;ALT_CC_VER&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 16.00.30319.01
SET &lt;span class=&quot;nv&quot;&gt;ALT_MSC_VER_RAW&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 16.00.30319.01&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;其中带~的路径均为cygpath所转化所得的short路径。&lt;/p&gt;

&lt;p&gt;建议路径中的分割符采用斜线（/）而不是反斜线（\），Windows资源管理器的默认显示路径是后者。如果采用反斜线，有可能在编译过程中某些脚本识别不出路径，从而出错。&lt;/p&gt;

&lt;p&gt;同时cygwin的bin目录在PATH中的位置应该在系统的System32目录之前（脚本中会用到cygwin的find命令，否则会用windows的find命令导致出错）。而VC++的bin目录应该在cygwin之前（同样的原因，编译需要用到的是VC++中的link.exe）。&lt;/p&gt;

&lt;p&gt;(9) 修改文件。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;文件： /jdk/make/sun/font/Makefile:&lt;/strong&gt;
&lt;strong&gt;第126行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;FREETYPE_LIB&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIB_LOCATION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIB_PREFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;freetype.&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIBRARY_SUFFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;FREETYPE_LIB&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIB_LOCATION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIB_PREFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;freetype6.&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIBRARY_SUFFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;nv&quot;&gt;ZLIB1_LIB&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIB_LOCATION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIB_PREFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;zlib1.&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIBRARY_SUFFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;第137，138行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;FREETYPE_LIB&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;:
 
&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;CP&lt;span class=&quot;k&quot;&gt;)$(&lt;/span&gt;FREETYPE_LIB_PATH&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIB_PREFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;freetype.&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIBRARY_SUFFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$@&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;FREETYPE_LIB&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;ZLIB1_LIB&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
 
&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;CP&lt;span class=&quot;k&quot;&gt;)$(&lt;/span&gt;FREETYPE_LIB_PATH&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIB_PREFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;freetype6.&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIBRARY_SUFFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$@&lt;/span&gt;
 
&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;install-module-file&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
 
&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;ZLIB1_LIB&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;:
 
&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;CP&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;FREETYPE_LIB_PATH&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIB_PREFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;zlib1.&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;LIBRARY_SUFFIX&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$@&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;文件：jdk/make/tools/freetypecheck/Makefile&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;第41行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;FREETYPE_DLL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;FREETYPE_LIB_PATH&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/freetype.dll&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;FREETYPE_DLL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;FREETYPE_LIB_PATH&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/freetype6.dll
 
&lt;span class=&quot;nv&quot;&gt;ZLIB1_DLL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;FREETYPE_LIB_PATH&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/zlib1.dll&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;第72行下加入：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;CP&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;ZLIB1_DLL&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;@D&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;文件：jdk/src/share/classes/sun/font/FontManagerNativeLibrary.java&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;第59行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;loadLibrary&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;freetype&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;loadLibrary&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;freetype6&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;OpenJDK的部分java文件注释是中文的。javac却指定了ascii编码方式（添加了参数-encoding ascii）。遇到包含中文的java文件，javac会报错。因此需要将-encoding编译选项去掉。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;文件：/corba/make/common/shared/Defs-java.gmk&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;第133行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;JAVACFLAGS +&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; -encoding ascii&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;c&quot;&gt;# JAVACFLAGS  += -encoding ascii&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;第194行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;BOOT_JAVACFLAGS  +&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; -encoding ascii -source&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;BOOT_SOURCE_LANGUAGE_VERSION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; -target &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;BOOT_TARGET_CLASS_VERSION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;BOOT_JAVACFLAGS +&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; -source &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;BOOT_SOURCE_LANGUAGE_VERSION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;-target &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;BOOT_TARGET_CLASS_VERSION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;文件：/jdk/make/common/shared/Defs-java.gmk&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;第134行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;JAVACFLAGS +&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; -encoding ascii&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;c&quot;&gt;# JAVACFLAGS  += -encoding ascii&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;第212行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;BOOT_JAVACFLAGS  +&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; -encoding ascii -source&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;BOOT_SOURCE_LANGUAGE_VERSION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; -target &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;BOOT_TARGET_CLASS_VERSION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;BOOT_JAVACFLAGS +&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; -source&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;BOOT_SOURCE_LANGUAGE_VERSION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; -target &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;BOOT_TARGET_CLASS_VERSION&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;文件：/hotspot/make/windows/makefiles/rules.make&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;第48行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;JAVAC_FLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;-g -encoding ascii&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;JAVAC_FLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;-g&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;OpenJDK启用了VC的“将警告视为错误”（warnings as errors）选项。如果链接器生成警告，/WX 将不会生成任何输出文件。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;文件：/hotspot/make/windows/makefiles/compile.make&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;第53行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;CPP_FLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/nologo /W3 /WX&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;&lt;span class=&quot;nv&quot;&gt;CPP_FLAGS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/nologo /W3 /WX-&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;文件：/hotspot/src/share/tools/hsdis/Makefile&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;第92行：&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;CFLAGS        +&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /nologo /MD /W3 /WX /O2 /Fo&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;@:.dll&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;.obj&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; /Gi-&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sh&quot; data-lang=&quot;sh&quot;&gt;CFLAGS        +&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /nologo /MD /W3 /WX- /O2 /Fo&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;@:.dll&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;.obj&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; /Gi-&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;文件：/hotspot/make/windows/get_msc_ver.sh以及/jdk/make/common/shared/Compiler-msvc.gmk&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;由于get_msc_ver.sh脚本文件是根据cl.exe的输出信息来判断编译器的版本的，而这个脚本只考虑了输出信息为英文的情况，所以本文开头强烈建议使用英文版的系统以及VS进行编译。如果你使用中文系统，那么有两个选择，一是将系统的区域和语言设置改为英文；二是直接将MSC_VER_RAW和CC_VER两个变量的值写入这两个文件（当然前提是你确保使用的编译器版本正确）。第二种方法我没有尝试成功，最后在虚拟机中安装了英文系统才编译通过。&lt;/p&gt;

&lt;p&gt;另外编译过程中如果出现COMPILER_VERSION没有设置的提示，那么可以直接将COMPILER_VERSION = VS2010写入Compiler-msvc.gmk。&lt;/p&gt;

&lt;p&gt;(10) 下面就可以进入openjdk目录进行编译了。&lt;/p&gt;

&lt;p&gt;首先输入bash进入cygwin环境，然后输入make sanity进行环境变量检查，如果回显输出make sanity pass就可以继续了，如果出错那么需要回头检查一下之前的设置是否正确。最后输入make进行编译即可。当然还有可能出错，那就要仔细查看错误输出再尝试解决了。&lt;/p&gt;

&lt;p&gt;我的机器是i5 3470 + 16G，在虚拟机中分配了1G的RAM（如果你的RAM小于512M，编译的时候工具会提醒你也许会很耗时），总共用了半个小时多一点编译完成。&lt;/p&gt;

&lt;p&gt;-EOF-&lt;/p&gt;

    &lt;p&gt;&lt;a href=&quot;/compile-jdk7-under-windows/&quot;&gt;Windows下编译OpenJDK7 笔记&lt;/a&gt; was originally published by Insomnia at &lt;a href=&quot;&quot;&gt;零時寝子&lt;/a&gt; on November 19, 2012.&lt;/p&gt;
  </content>
</entry>

</feed>
